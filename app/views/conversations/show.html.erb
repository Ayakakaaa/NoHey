<script type="text/javascript">
    const CONVERSATION_ID = <%= @conversation.id %>;
    const CURRENT_USER_ID = <%= current_user.id %>;
</script>
<div>
    <%  @conversation.other_participants(current_user).each do |pa| %>
        <% if pa.images.attached? %>
            <h3><%= pa.first_name %></h3>
            <%= image_tag pa.images.first, class: "pic" %>
        <% else %>
            <h3><%= pa.first_name %></h3>
            <%= image_tag 'icon2.jpeg', class: "pic wait" %>
        <% end %>  
    <% end %>
</div>

<div id="chat" data-conversation-id="<%= @conversation.id %>" class="conversation-box">
    <% @conversation.messages.each do |message| %>
        <% if message.sender_id != current_user.id %>
            <div class='left-message'>
                <div class="chat-pic">
                    <% if message.sender.images.attached? %>
                        <%= image_tag message.sender.images.first, class: "pic" %>
                    <% else %>
                        <%= image_tag 'icon2.jpeg', class: "pic" %>
                    <% end %>
                </div>
                <div class='left-box'>
                    <div class="says">
                        <p>
                            <% if message.image.attached? %>
                                <%= image_tag message.image, class: "img-fit" %>
                            <% end %>
                            <span id="<%=message.id%>"><%= message.content %></span>
                        </p>
                    </div>
                </div>
            </div>
        <% else %>
            <div class='mycomment'>
                <p>
                    <% if message.image.attached? %>
                        <%= image_tag message.image, class: "img-fit" %>
                    <% end %>
                    <span id="<%=message.id%>"><%= message.content %></span>
                </p>
            </div>
        <% end %>
    <% end %>
</div>

<div>
    <%= form_with model: [@conversation, @new_message], remote: true do |form| %>
        <%= form.text_area :content, placeholder: "type message here", autofocus: true %>
        <%= form.file_field :image %>
        <%= form.submit %>
    <% end %>
</div>
